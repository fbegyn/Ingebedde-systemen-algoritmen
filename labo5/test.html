<!DOCTYPE html>
<html>
<head>
	
	<title>Labo 5 plotted</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>


	
</head>
<body>



<div id="mapid" style="width: 800px; height: 600px;"></div>
<script>
  // Get search params
  var url = window.location.href;
  var hash = url.substring(url.indexOf("?")+1);
  var params = new URLSearchParams(hash);
  // Make a map
	var map = L.map('mapid').setView([51.0543422, 3.7174243], 8);
	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 20,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(map);

  // Get JSON from PHP files
  var xmlhttp = new XMLHttpRequest();
  var pa = [];
  xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var res = JSON.parse(this.responseText);
        console.log(res);
        for(var i = 0; i < res.loc.length;i++){
          step = res.loc[i];
          p = [step.lat,step.lon];
          pa.push(p);
          L.marker([step.lat,step.lon]).addTo(map).bindPopup("Name:"+step.name
            +"<br>Id: "+step.id
            +"<br>Step: "+(i+1)
            +"<br>Coord: ["+step.lat+","+step.lon+"]");
        }
      }
  };

  L.polyline(pa,{color: 'blue'}).addTo(map);
  
  xmlhttp.open("GET", "dijkstra.php?from_lat="+params.get("from_lat")
                        +"&from_lon="+params.get("from_lon")
                        +"&to_lat="+params.get("to_lat")
                        +"&to_lon="+params.get("to_lon")
                        +"&transport="+params.get("transport"), true);
  xmlhttp.send();

</script>
</body>
</html>


